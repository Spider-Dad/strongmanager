# GetCourse Telegram Bot

Телеграм-бот для оповещения наставников онлайн школы Strong Manager о действиях студентов в платформе GetCourse.

---

## Функциональность

- Авторизация наставников по email (привязка Telegram к email из справочника mentors)
- Получение уведомлений о новых ответах студентов на задания (тип: answerToLesson)
- Получение уведомлений о комментариях студентов к урокам (тип: commentOnLesson)
- Получение уведомлений о приближающихся дедлайнах, если студент не дал ответ (тип: deadlineApproaching)
- Исключение дублей уведомлений (каждое событие — только одно уведомление)
- Логирование истории отправленных уведомлений

---

## Логика работы

1. Бот периодически опрашивает Google Sheets (лист notifications) через API
2. Получает новые уведомления для наставников (по их Telegram ID)
3. Отправляет сообщения в Telegram (поддержка форматирования)
4. Обновляет статус уведомления (sent/failed)
5. Ведёт историю отправленных уведомлений

---

## Типы уведомлений

- **answerToLesson** — студент отправил новый ответ на урок
- **commentOnLesson** — студент оставил комментарий к уроку
- **deadlineApproaching** — студент не дал ответ, а до дедлайна менее 24 часов

---

## Настройка и запуск

### Переменные окружения

Создайте файл `.env` на основе `.env.example` и заполните необходимые параметры:

- `BOT_TOKEN` — токен Telegram-бота
- `API_URL` — адрес API Google Apps Script (web app)
- `ADMIN_EMAIL` — email администратора (для логов)

### Запуск

```bash
python main.py
```

---

## Взаимодействие с Google Sheets

- Все уведомления формируются и хранятся в Google Sheets (лист notifications)
- Бот не работает напрямую с логами студентов — только с готовыми уведомлениями
- Для корректной работы требуется, чтобы у наставника был указан Telegram ID в справочнике mentors

---

## Тестирование
- Для тестирования используйте тестовые функции в Google Apps Script (см. apps_script/tests.gs)
- Проверяйте, что уведомления появляются в листе notifications и отправляются в Telegram
