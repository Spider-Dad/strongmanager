# üéâ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-12-21
**–í–µ—Ç–∫–∞:** `refactoring/phase3-business-logic` ‚Üí `refactoring` ‚Üí `main`

---

## –ò—Ç–æ–≥–∏ –≤—Å–µ—Ö —Ñ–∞–∑

### ‚úÖ –§–∞–∑–∞ 1: PostgreSQL Schema & Models

**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–î–∞—Ç–∞:** 2025-12-20
**–í–µ—Ç–∫–∞:** `refactoring/phase1-postgresql-schema`

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- –°–æ–∑–¥–∞–Ω–∞ SQL-—Å—Ö–µ–º–∞ PostgreSQL —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
- –û–±–Ω–æ–≤–ª–µ–Ω—ã SQLAlchemy –º–æ–¥–µ–ª–∏ –¥–ª—è PostgreSQL
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å WebhookEvent –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤ GetCourse
- –ù–∞—Å—Ç—Ä–æ–µ–Ω connection pooling –¥–ª—è asyncpg
- –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `wiki/REFACTORING_PHASE1.md`, `wiki/PHASE1_COMPLETE.md`

---

### ‚úÖ –§–∞–∑–∞ 2: n8n Webhook Integration

**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–î–∞—Ç–∞:** 2025-12-21
**–í–µ—Ç–∫–∞:** `refactoring/phase2-n8n-webhooks`

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- –û–±–Ω–æ–≤–ª–µ–Ω n8n workflow —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞–∑–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–≤–∞–ª–∏–¥–∞—Ü–∏—è + –ë–î)
- –î–æ–±–∞–≤–ª–µ–Ω–æ —è–≤–Ω–æ–µ –ø–æ–ª–µ `processed = false`
- –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (100% —É—Å–ø–µ—Ö –ø—Ä–∏ 2-3 –∑–∞–ø—Ä–æ—Å–∞—Ö/—Å–µ–∫)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `wiki/REFACTORING_PHASE2.md`, `wiki/PHASE2_COMPLETE.md`

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç: 20 –∑–∞–ø—Ä–æ—Å–æ–≤, –∑–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫ ‚Üí 100% —É—Å–ø–µ—Ö
- ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç: 100 –∑–∞–ø—Ä–æ—Å–æ–≤, –∑–∞–¥–µ—Ä–∂–∫–∞ 500ms ‚Üí 100% —É—Å–ø–µ—Ö
- ‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: 100 –∑–∞–ø—Ä–æ—Å–æ–≤, –∑–∞–¥–µ—Ä–∂–∫–∞ 200ms ‚Üí 82% (–æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è)

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 2-3 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫

---

### ‚úÖ –§–∞–∑–∞ 3: –ú–∏–≥—Ä–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (GAS ‚Üí Python)

**–°—Ç–∞—Ç—É—Å:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ
**–î–∞—Ç–∞:** 2025-12-21
**–í–µ—Ç–∫–∞:** `refactoring/phase3-business-logic`

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- –°–æ–∑–¥–∞–Ω–æ 5 –Ω–æ–≤—ã—Ö Python-—Å–µ—Ä–≤–∏—Å–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—É–¥–∞–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç GAS API)
- –û–±–Ω–æ–≤–ª–µ–Ω main.py (4 –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ APScheduler)
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (8 –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- –°–æ–∑–¥–∞–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (unit + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ)
- –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω README –≤ getcourse_apps_script (–ø–æ–º–µ—Ç–∫–∞ ARCHIVED)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `wiki/REFACTORING_PHASE3.md`, `wiki/PHASE3_COMPLETE.md`, `wiki/PHASE3_TESTING_GUIDE.md`

**–ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
1. `WebhookProcessingService` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
2. `NotificationCalculationService` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
3. `DeadlineCheckService` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤ (–∫–∞–∂–¥—ã–π —á–∞—Å)
4. `ReminderService` - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (—Ä–∞–∑ –≤ –¥–µ–Ω—å 12:00 MSK)
5. `NotificationSenderService` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram (–∫–∞–∂–¥—ã–µ 15 —Å–µ–∫)

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –î–æ (GAS) | –ü–æ—Å–ª–µ (Python + PostgreSQL) |
|----------------|----------|----------------------------|
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | Google Sheets | PostgreSQL 17.6 |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤** | Apps Script —Ç—Ä–∏–≥–≥–µ—Ä—ã | n8n ‚Üí Python —Å–µ—Ä–≤–∏—Å—ã |
| **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** | JavaScript (GAS) | Python 3.11+ |
| **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** | –ß–µ—Ä–µ–∑ GAS API | –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (Telegram API) |
| **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** | GAS Time-based triggers | APScheduler |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ (Google –∫–≤–æ—Ç—ã) | –í—ã—Å–æ–∫–∞—è (async, batching) |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** | –°—Ä–µ–¥–Ω—è—è (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Google) | –í—ã—Å–æ–∫–∞—è (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, retry) |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | –õ–æ–≥–∏ GAS | –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ + –ë–î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (Google) | Amvera (–ø–ª–∞—Ç–Ω–æ, –Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ) |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  GetCourse  ‚îÇ  –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ–±—É—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ Webhook (POST)
       v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     n8n     ‚îÇ  –í–∞–ª–∏–¥–∞—Ü–∏—è + –∑–∞–ø–∏—Å—å –≤ –ë–î
‚îÇ  Workflow   ‚îÇ  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
‚îÇ             ‚îÇ  - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
‚îÇ             ‚îÇ  - INSERT –≤ webhook_events
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         PostgreSQL 17.6            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (–≤—Ä—É—á–Ω—É—é):       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - mentors                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - students                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - trainings                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - lessons                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - mapping                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ –î–∞–Ω–Ω—ã–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - webhook_events             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - notifications              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Python Bot Services           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ WebhookProcessingService     ‚îÇ  ‚îÇ  –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫
‚îÇ  ‚îÇ - –ß–∏—Ç–∞–µ—Ç processed=false     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - –°–æ–∑–¥–∞–µ—Ç notifications      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ DeadlineCheckService         ‚îÇ  ‚îÇ  –ö–∞–∂–¥—ã–π —á–∞—Å
‚îÇ  ‚îÇ - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–µ–¥–ª–∞–π–Ω—ã         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - –°–æ–∑–¥–∞–µ—Ç notifications      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ ReminderService              ‚îÇ  ‚îÇ  –†–∞–∑ –≤ –¥–µ–Ω—å (12:00 MSK)
‚îÇ  ‚îÇ - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - –°–æ–∑–¥–∞–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è        ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ NotificationSenderService    ‚îÇ  ‚îÇ  –ö–∞–∂–¥—ã–µ 15 —Å–µ–∫
‚îÇ  ‚îÇ - –ß–∏—Ç–∞–µ—Ç status=pending      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram   ‚îÇ  –ú–µ–Ω—Ç–æ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   Mentors   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ù–ï –º–∏–≥—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!** –í—Å–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ DBeaver:

- `mentors` - –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏ (telegram_id = NULL –¥–ª—è –Ω–æ–≤—ã—Ö, –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- `students` - —Å—Ç—É–¥–µ–Ω—Ç—ã
- `trainings` - —Ç—Ä–µ–Ω–∏–Ω–≥–∏
- `lessons` - —É—Ä–æ–∫–∏ (—Å deadline_date)
- `mapping` - —Å–≤—è–∑–∏ —Å—Ç—É–¥–µ–Ω—Ç-–º–µ–Ω—Ç–æ—Ä-—Ç—Ä–µ–Ω–∏–Ω–≥

### –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets **–Ω–µ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è**. –°–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ—Ç —Ä–∏—Å–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ —Å–ª–æ–∂–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
- ‚úÖ –ß–∏—Å—Ç—ã–π —Å—Ç–∞—Ä—Ç —Å –Ω–æ–≤—ã–º –ø–æ—Ç–æ–∫–æ–º –æ–±—É—á–µ–Ω–∏—è

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### 1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –≤ PostgreSQL

–°–º. `wiki/REFACTORING_PHASE3.md` —Ä–∞–∑–¥–µ–ª 7.1

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
SELECT
  (SELECT COUNT(*) FROM mentors WHERE valid_to = '9999-12-31'::TIMESTAMPTZ) as mentors,
  (SELECT COUNT(*) FROM students WHERE valid_to = '9999-12-31'::TIMESTAMPTZ) as students,
  (SELECT COUNT(*) FROM trainings WHERE valid_to = '9999-12-31'::TIMESTAMPTZ) as trainings,
  (SELECT COUNT(*) FROM lessons WHERE valid_to = '9999-12-31'::TIMESTAMPTZ) as lessons,
  (SELECT COUNT(*) FROM mapping WHERE valid_to = '9999-12-31'::TIMESTAMPTZ) as mappings;
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å .env –Ω–∞ Amvera

–î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `env.example`:

```bash
WEBHOOK_PROCESSING_INTERVAL=30
DEADLINE_CHECK_INTERVAL_MINUTES=60
NOTIFICATION_SEND_INTERVAL=15
DEADLINE_WARNING_HOURS=36
REMINDER_TRIGGER_HOUR=12
REMINDER_ANALYSIS_DAYS_BACK=2
WEBHOOK_BATCH_SIZE=50
NOTIFICATION_BATCH_SIZE=20
```

### 3. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Unit-—Ç–µ—Å—Ç—ã
python tests/test_notification_calculator.py
python tests/test_webhook_processor.py
python tests/test_deadline_checker.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω
python tests/test_timezone_verification.py

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç (—Ç—Ä–µ–±—É–µ—Ç PostgreSQL)
python tests/test_manual_full_cycle.py
```

### 4. –°–ª–∏—Ç—å –≤–µ—Ç–∫–∏

```bash
# –°–ª–∏—Ç—å phase3 –≤ refactoring
git checkout refactoring
git merge refactoring/phase3-business-logic

# –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–∏—Ç—å –≤ main
git checkout main
git merge refactoring
git push origin main
```

### 5. –û—Ç–∫–ª—é—á–∏—Ç—å GAS —Ç—Ä–∏–≥–≥–µ—Ä—ã

**–í Google Apps Script:**
```javascript
function disableAllTriggers() {
  const triggers = ScriptApp.getProjectTriggers();
  for (let trigger of triggers) {
    ScriptApp.deleteTrigger(trigger);
  }
  console.log(`‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–æ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤: ${triggers.length}`);
}
```

---

## –ó–∞–ø—É—Å–∫ –≤ production

### –ü–ª–∞–Ω –∑–∞–ø—É—Å–∫–∞

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –ë–æ—Ç —Å–µ–π—á–∞—Å –æ—Ç–∫–ª—é—á–µ–Ω, –∑–∞–ø—É—Å–∫ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Å –Ω–∞—á–∞–ª–æ–º –Ω–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –æ–±—É—á–µ–Ω–∏—è.

**–ó–∞ –Ω–µ–¥–µ–ª—é –¥–æ —Å—Ç–∞—Ä—Ç–∞:**
- ‚úÖ –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ –°–ª–∏—Ç—å –≤–µ—Ç–∫–∏
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å .env –Ω–∞ Amvera

**–í –¥–µ–Ω—å —Å—Ç–∞—Ä—Ç–∞:**
- –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Amvera (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ git push)
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
- –£–≤–µ–¥–æ–º–∏—Ç—å –º–µ–Ω—Ç–æ—Ä–æ–≤ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –±–æ—Ç–µ

**–ü–µ—Ä–≤—ã–µ —á–∞—Å—ã:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–≤—ã—Ö –≤–µ–±—Ö—É–∫–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–µ—Ä–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–õ–æ–≥–∏:**
```bash
# –ù–∞ Amvera –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
tail -f logs/bot.log | grep -E "–ù–∞–π–¥–µ–Ω–æ|–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞|–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
```

**PostgreSQL:**
```sql
-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
SELECT
  (SELECT COUNT(*) FROM webhook_events WHERE created_at > NOW() - INTERVAL '1 hour') as webhooks,
  (SELECT COUNT(*) FROM webhook_events WHERE processed = false) as pending_webhooks,
  (SELECT COUNT(*) FROM notifications WHERE created_at > NOW() - INTERVAL '1 hour') as notifications,
  (SELECT COUNT(*) FROM notifications WHERE status = 'pending') as pending_notifications,
  (SELECT COUNT(*) FROM notifications WHERE sent_at > NOW() - INTERVAL '1 hour') as sent;
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –¢–µ–∫—É—â–µ–µ |
|---------|-----------------|---------|
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ | 100% (0 –ø–æ—Ç–µ—Ä—å) | - |
| –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–∞ | < 5 —Å–µ–∫ | - |
| –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | 100% –¥–æ—Å—Ç–∞–≤–∫–∞ | - |
| –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | < 30 —Å–µ–∫ –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è | - |
| –î–µ–¥–ª–∞–π–Ω—ã –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤ | 100% | - |
| –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 12:00 MSK | - |

### –¢–µ–∫—É—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å n8n

**–ò–∑ –§–∞–∑—ã 2:**
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: 2-3 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫
- ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 100% –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ 500ms
- ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: >5 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–∞–π–º–∞—É—Ç–∞–º

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã (–§–∞–∑–∞ 3)

**–°–µ—Ä–≤–∏—Å—ã:**
- `bot/services/webhook_processor.py` - 292 —Å—Ç—Ä–æ–∫–∏
- `bot/services/notification_calculator.py` - 214 —Å—Ç—Ä–æ–∫
- `bot/services/deadline_checker.py` - 332 —Å—Ç—Ä–æ–∫–∏
- `bot/services/reminder_service.py` - 287 —Å—Ç—Ä–æ–∫
- `bot/services/notification_sender.py` - 177 —Å—Ç—Ä–æ–∫

**–¢–µ—Å—Ç—ã:**
- `tests/test_phase3_integration.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç
- `tests/test_webhook_processor.py` - unit-—Ç–µ—Å—Ç—ã
- `tests/test_deadline_checker.py` - unit-—Ç–µ—Å—Ç—ã
- `tests/test_notification_calculator.py` - unit-—Ç–µ—Å—Ç—ã
- `tests/test_timezone_verification.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω
- `tests/test_manual_full_cycle.py` - —Ä—É—á–Ω–æ–π –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `wiki/REFACTORING_PHASE3.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –§–∞–∑—ã 3
- `wiki/PHASE3_COMPLETE.md` - –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
- `wiki/PHASE3_TESTING_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- `wiki/REFACTORING_COMPLETE.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–§–∞–∑–∞ 3)

**–ö–æ–¥:**
- `bot/handlers/auth.py` - —É–¥–∞–ª–µ–Ω—ã GAS API –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `main.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã 4 –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ APScheduler
- `bot/config.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã 8 –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `env.example` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- `requirements.txt` - –¥–æ–±–∞–≤–ª–µ–Ω pytz
- `README.md` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `getcourse_apps_script/README.md` - –ø–æ–º–µ—Ç–∫–∞ "ARCHIVED"

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ë–æ–ª—å—à–µ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:**
- ‚ùå `bot.services.api.get_mentor_by_email()`
- ‚ùå `bot.services.api.register_telegram_id()`
- ‚ùå `bot.services.api.get_new_notifications()`
- ‚ùå `bot.services.api.update_notification_status()`
- ‚ùå `bot.services.notifications.check_new_notifications()`
- ‚ùå –õ—é–±—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ `config.api_url` (GAS API URL)

---

## –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [x] PostgreSQL –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- [x] n8n workflow –∞–∫—Ç–∏–≤–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] .env –Ω–∞ Amvera –æ–±–Ω–æ–≤–ª–µ–Ω —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- [ ] –ë–æ—Ç –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Amvera

### –î–∞–Ω–Ω—ã–µ
- [ ] –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã (mentors, students, trainings, lessons, mapping)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã views (v_active_*)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω integrity (–≤—Å–µ mapping —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏)

### –ö–æ–¥
- [x] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- [x] main.py –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] auth.py –æ–±–Ω–æ–≤–ª–µ–Ω (–±–µ–∑ GAS)
- [x] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [x] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] Unit-—Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–Ω
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω –ø—Ä–æ–π–¥–µ–Ω–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] REFACTORING_PHASE3.md
- [x] PHASE3_COMPLETE.md
- [x] PHASE3_TESTING_GUIDE.md
- [x] README.md –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] getcourse_apps_script/README.md –æ–±–Ω–æ–≤–ª–µ–Ω (ARCHIVED)

### Git
- [x] –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–µ—Ç–∫–µ `refactoring/phase3-business-logic`
- [ ] –°–ª–∏—Ç–æ –≤ `refactoring`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –≤–µ—Ç–∫–µ `refactoring`
- [ ] –ì–æ—Ç–æ–≤–æ –∫ merge –≤ `main`

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–µ—Ä–≤—ã—Ö 24 —á–∞—Å–æ–≤
- [ ] –ú–µ–Ω—Ç–æ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] GAS —Ç—Ä–∏–≥–≥–µ—Ä—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã
- [ ] GAS –ø—Ä–æ–µ–∫—Ç –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ Google Drive

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–°–ï–ô–ß–ê–°)

```bash
cd getcourse_bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–æ–Ω
python tests/test_timezone_verification.py

# –†—É—á–Ω–æ–π —Ç–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
python tests/test_manual_full_cycle.py
```

### 2. –°–ª–∏—è–Ω–∏–µ –≤–µ—Ç–æ–∫

```bash
# –°–ª–∏—Ç—å phase3 –≤ refactoring
git checkout refactoring
git merge refactoring/phase3-business-logic

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
git log --oneline -10
```

### 3. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ production

```bash
# –ù–∞ –≤–µ—Ç–∫–µ refactoring
python tests/test_manual_full_cycle.py
python tests/test_timezone_verification.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç GAS
grep -r "api_url" bot/ --exclude-dir=__pycache__
grep -r "register_telegram_id" bot/ --exclude-dir=__pycache__
```

### 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ production –¥–∞–Ω–Ω—ã—Ö

**–ó–∞ –Ω–µ–¥–µ–ª—é –¥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ—Ç–æ–∫–∞:**
- –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL (mentors, students, trainings, lessons, mapping)
- –û–±–Ω–æ–≤–∏—Ç—å .env –Ω–∞ Amvera
- –£–≤–µ–¥–æ–º–∏—Ç—å –º–µ–Ω—Ç–æ—Ä–æ–≤ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –±–æ—Ç–µ

### 5. Deploy –≤ production

```bash
# –ö–æ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–ø—É—Å–∫—É
git checkout main
git merge refactoring
git push origin main  # –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π –Ω–∞ Amvera
```

### 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ü–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞:**
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å PostgreSQL —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥—ã–π —á–∞—Å
- –°–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ—Ç –º–µ–Ω—Ç–æ—Ä–æ–≤

**–ü–æ—Å–ª–µ 48 —á–∞—Å–æ–≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã:**
- –û—Ç–∫–ª—é—á–∏—Ç—å GAS —Ç—Ä–∏–≥–≥–µ—Ä—ã
- –û–±–Ω–æ–≤–∏—Ç—å README –≤ getcourse_apps_script
- –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤–Ω—É—é –∫–æ–ø–∏—é –Ω–∞ Google Drive

---

## –†–∏—Å–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### –†–∏—Å–∫ 1: –ù–µ–ø–æ–ª–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–°–∏–º–ø—Ç–æ–º:** –í–µ–±—Ö—É–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è, –Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å integrity
SELECT * FROM v_active_mappings LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã/–º–µ–Ω—Ç–æ—Ä—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
SELECT DISTINCT user_id FROM webhook_events
WHERE user_id NOT IN (SELECT student_id FROM students);
```

### –†–∏—Å–∫ 2: –ú–µ–Ω—Ç–æ—Ä—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å

**–°–∏–º–ø—Ç–æ–º:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `no_telegram_id`

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–¥–æ–º–∏—Ç—å –º–µ–Ω—Ç–æ—Ä–æ–≤ –∑–∞—Ä–∞–Ω–µ–µ (–∑–∞ –Ω–µ–¥–µ–ª—é)
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ `pending` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö:
```sql
UPDATE notifications
SET status = 'pending'
WHERE mentor_id = (SELECT id FROM mentors WHERE email = 'mentor@example.com')
AND status = 'no_telegram_id';
```

### –†–∏—Å–∫ 3: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã

**–°–∏–º–ø—Ç–æ–º:** –î–µ–¥–ª–∞–π–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
python tests/test_timezone_verification.py

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# - PostgreSQL timezone: UTC
# - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Moscow TZ —Ä–∞–±–æ—Ç–∞–µ—Ç (+3 —á–∞—Å–∞)
# - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** Pavel Shvydkin
**Email:** (—É–∫–∞–∑–∞—Ç—å)
**Telegram:** @spiderdad

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** `getcourse_bot/` (–æ—Å–Ω–æ–≤–Ω–æ–π), `getcourse_apps_script/` (–∞—Ä—Ö–∏–≤)
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `getcourse_bot/wiki/`

---

**–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!** üéâ

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ production –∑–∞–ø—É—Å–∫—É
