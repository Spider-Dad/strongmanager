# –†–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–±–ª–µ–º —Å Google Script

## –ü—Ä–æ–±–ª–µ–º–∞
Google Apps Script –≤–æ–∑–≤—Ä–∞—â–∞–ª HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –æ—à–∏–±–∫–∞–º–∏ –≤–º–µ—Å—Ç–æ JSON, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É:
```
Attempt to decode JSON with unexpected mimetype: text/html; charset=utf-8
```

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Content-Type
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Content-Type` –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ HTML –æ—Ç–≤–µ—Ç–æ–≤ –¥–æ –ø–æ–ø—ã—Ç–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ "unexpected mimetype"

### 2. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ HTML –æ—Ç–≤–µ—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `GoogleScriptError` –¥–ª—è HTML –æ—à–∏–±–æ–∫
- –§—É–Ω–∫—Ü–∏—è `_extract_error_from_html()` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—à–∏–±–∫–∞—Ö
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTML –æ—Ç–≤–µ—Ç–æ–≤

### 3. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Content-Type –æ—Ç–≤–µ—Ç–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTML —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤)
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫ (GoogleScriptError, ApiError, –æ–±—â–∏–µ)

### 4. ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º
- GoogleScriptError –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è retry
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö Google Script

### 5. ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- –ú–æ–¥—É–ª—å `bot/utils/gs_diagnostics.py` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Google Script
- –ö–æ–º–∞–Ω–¥–∞ `/alerts` ‚Üí "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ GScript" –≤ –∞–¥–º–∏–Ω—Å–∫–æ–º –º–µ–Ω—é
- –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test_gs_error_handling.py`

### 6. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
- –û–±–Ω–æ–≤–ª–µ–Ω `bot/services/notifications.py` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
- –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ –ª–æ–≥–∞—Ö
- Graceful fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`bot/services/api.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ Content-Type
   - –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å GoogleScriptError
   - –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –∏–∑ HTML
   - –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **`bot/services/notifications.py`**
   - –ò–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
   - –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ GoogleScriptError
   - –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

3. **`bot/utils/gs_diagnostics.py`** (–Ω–æ–≤—ã–π)
   - –ö–ª–∞—Å—Å GoogleScriptDiagnostics
   - –¢–µ—Å—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, Content-Type, –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤

4. **`bot/handlers/admin.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Google Script
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback_alerts_gs_diagnostics
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

5. **`test_gs_error_handling.py`** (–Ω–æ–≤—ã–π)
   - –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
   - –¢–µ—Å—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

6. **`GOOGLE_SCRIPT_ERROR_HANDLING.md`** (–Ω–æ–≤—ã–π)
   - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞**: –û—à–∏–±–∫–∏ "unexpected mimetype: text/html" –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç

‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö Google Script

‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ö–æ–º–∞–Ω–¥–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã

‚úÖ **–ü–æ–≤—ã—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç**: `python test_gs_error_handling.py`
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É**: `/alerts` ‚Üí "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ GScript"
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**: –ò—â–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## –°—Ç–∞—Ç—É—Å

üü¢ **–ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ**

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é. –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π HTML –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç Google Script –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞.