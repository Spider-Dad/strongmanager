{
  "name": "Getcourse_webhook_insert",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "getcoursebd",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -240,
        0
      ],
      "id": "e40ed6cc-7f93-4acd-8542-e98cc6f3cfc2",
      "name": "Webhook",
      "webhookId": "767cd395-45c7-494f-b5e1-f52c3de56a16"
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–∞\n// ============================================\n\nconst body = $json.body || {};\n\n// –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ö–µ–º–µ PostgreSQL\nconst requiredFields = [\n  'eventDate',\n  'userId',\n  'userEmail',\n  'answerId'\n];\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π\nconst missingFields = requiredFields.filter(field => {\n  const value = body[field];\n  return value === undefined || value === null || value === '';\n});\n\nif (missingFields.length > 0) {\n  throw new Error(\n    `–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missingFields.join(', ')}. ` +\n    `–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(body, null, 2)}`\n  );\n}\n\n// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö\nconst errors = [];\n\n// userId –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –∏–ª–∏ —Å—Ç—Ä–æ–∫–æ–π —Å —á–∏—Å–ª–æ–º\nif (body.userId && isNaN(Number(body.userId))) {\n  errors.push(`userId –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º, –ø–æ–ª—É—á–µ–Ω–æ: ${body.userId}`);\n}\n\n// answerId –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –∏–ª–∏ —Å—Ç—Ä–æ–∫–æ–π —Å —á–∏—Å–ª–æ–º\nif (body.answerId && isNaN(Number(body.answerId))) {\n  errors.push(`answerId –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º, –ø–æ–ª—É—á–µ–Ω–æ: ${body.answerId}`);\n}\n\n// userEmail –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å @\nif (body.userEmail && !body.userEmail.includes('@')) {\n  errors.push(`userEmail –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º email, –ø–æ–ª—É—á–µ–Ω–æ: ${body.userEmail}`);\n}\n\n// eventDate –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω–æ–π –¥–∞—Ç–æ–π\nif (body.eventDate && isNaN(Date.parse(body.eventDate))) {\n  errors.push(`eventDate –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω–æ–π –¥–∞—Ç–æ–π, –ø–æ–ª—É—á–µ–Ω–æ: ${body.eventDate}`);\n}\n\n// –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ\nif (errors.length > 0) {\n  throw new Error(\n    `–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:\\n${errors.join('\\n')}\\n\\n` +\n    `–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(body, null, 2)}`\n  );\n}\n\n// –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ - –ø–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞–ª—å—à–µ\nreturn [$json];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -40,
        0
      ],
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "name": "–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö",
      "notesInFlow": true,
      "notes": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "webhook_events",
          "mode": "list",
          "cachedResultName": "webhook_events"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "event_date": "={{ $json.body.eventDate }}",
            "user_id": "={{ $json.body.userId }}",
            "user_email": "={{ $json.body.userEmail }}",
            "user_first_name": "={{ $json.body.userFirstName }}",
            "user_last_name": "={{ $json.body.userLastName }}",
            "answer_id": "={{ $json.body.answerId }}",
            "answer_training_id": "={{ $json.body.answerTrainingId }}",
            "answer_lesson_id": "={{ $json.body.answerLessonId }}",
            "answer_status": "={{ $json.body.answerStatus }}",
            "answer_text": "={{ $json.body.answerText }}",
            "answer_type": "={{ $json.body.answerType }}",
            "answer_teacher_id": "={{ $json.body.answerTeacherId }}",
            "raw_payload": "={{ $json.body }}",
            "processed": false
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "event_date",
              "displayName": "event_date",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "user_email",
              "displayName": "user_email",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "user_first_name",
              "displayName": "user_first_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "user_last_name",
              "displayName": "user_last_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "answer_id",
              "displayName": "answer_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "answer_training_id",
              "displayName": "answer_training_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "answer_lesson_id",
              "displayName": "answer_lesson_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "answer_status",
              "displayName": "answer_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "answer_text",
              "displayName": "answer_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "answer_type",
              "displayName": "answer_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "answer_teacher_id",
              "displayName": "answer_teacher_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "raw_payload",
              "displayName": "raw_payload",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "processed",
              "displayName": "processed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "processed_at",
              "displayName": "processed_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "error_message",
              "displayName": "error_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        192,
        0
      ],
      "id": "dcacd94c-5705-471c-a64c-b974641d96b5",
      "name": "–ó–∞–ø–∏—Å–∞—Ç—å –≤ –ë–î",
      "retryOnFail": true,
      "credentials": {
        "postgres": {
          "id": "WbJzfRZoYdghS2eI",
          "name": "Postgres account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        896,
        -16
      ],
      "id": "cab9b592-765b-4411-9672-1ab82b12ba76",
      "name": "–í—ã—Ö–æ–¥"
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –í–ê–õ–ò–î–ê–¶–ò–ò\n// ============================================\n\nconst body = $json.body || {};\nconst error = $json.error || {};\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\nlet message = `üõë <b>–û–®–ò–ë–ö–ê –í–ê–õ–ò–î–ê–¶–ò–ò WEBHOOK</b>\\n\\n`;\nmessage += `<b>–û—à–∏–±–∫–∞:</b> ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}\\n`;\n\n// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\nmessage += `\\n<b>üì¶ –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</b>\\n<code>`;\nif (body.eventDate) message += `eventDate: ${body.eventDate}\\n`;\nif (body.userId) message += `userId: ${body.userId}\\n`;\nif (body.userEmail) message += `userEmail: ${body.userEmail}\\n`;\nif (body.answerId) message += `answerId: ${body.answerId}\\n`;\nif (body.answerTrainingId) message += `trainingId: ${body.answerTrainingId}\\n`;\nif (body.answerLessonId) message += `lessonId: ${body.answerLessonId}\\n`;\nmessage += `</code>`;\n\n// –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞\nconst timestamp = new Date().toISOString();\nmessage += `\\n\\n<i>–í—Ä–µ–º—è: ${timestamp}</i>`;\n\nreturn [{ json: { message } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        192,
        176
      ],
      "id": "validation-error-handler-001",
      "name": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏",
      "notesInFlow": true,
      "notes": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö"
    },
    {
      "parameters": {
        "chatId": "-1003386133985",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        416,
        176
      ],
      "id": "telegram-validation-error-001",
      "name": "–ê–ª–µ—Ä—Ç: –í–∞–ª–∏–¥–∞—Ü–∏—è",
      "webhookId": "telegram-validation-webhook-001",
      "notesInFlow": true,
      "credentials": {
        "telegramApi": {
          "id": "Kbg7MPi01khEIzLB",
          "name": "Telegram account"
        }
      },
      "onError": "continueRegularOutput",
      "notes": "–û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞ –æ–± –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ó–ê–ü–ò–°–ò –í –ë–î\n// ============================================\n\nconst body = $json.body || {};\nconst error = $json.error || {};\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ë–î\nlet message = `üõë <b>–û–®–ò–ë–ö–ê –ó–ê–ü–ò–°–ò –í POSTGRESQL</b>\\n\\n`;\nmessage += `<b>–û—à–∏–±–∫–∞:</b> ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ë–î'}\\n`;\n\n// –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤–µ–±—Ö—É–∫–∞\nmessage += `\\n<b>üì¶ –î–∞–Ω–Ω—ã–µ –≤–µ–±—Ö—É–∫–∞:</b>\\n<code>`;\nif (body.eventDate) message += `eventDate: ${body.eventDate}\\n`;\nif (body.userId) message += `userId: ${body.userId}\\n`;\nif (body.userEmail) message += `userEmail: ${body.userEmail}\\n`;\nif (body.answerId) message += `answerId: ${body.answerId}\\n`;\nif (body.answerTrainingId) message += `trainingId: ${body.answerTrainingId}\\n`;\nif (body.answerLessonId) message += `lessonId: ${body.answerLessonId}\\n`;\nmessage += `</code>`;\n\n// –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞\nconst timestamp = new Date().toISOString();\nmessage += `\\n\\n<i>–í—Ä–µ–º—è: ${timestamp}</i>`;\n\nreturn [{ json: { message } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        416,
        -176
      ],
      "id": "db-error-handler-001",
      "name": "–û—à–∏–±–∫–∞ –ë–î",
      "notesInFlow": true,
      "notes": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–ø–∏—Å–∏ –≤ PostgreSQL"
    },
    {
      "parameters": {
        "chatId": "-1003386133985",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        640,
        -176
      ],
      "id": "telegram-db-error-001",
      "name": "–ê–ª–µ—Ä—Ç: –ë–î",
      "webhookId": "telegram-db-webhook-001",
      "notesInFlow": true,
      "credentials": {
        "telegramApi": {
          "id": "Kbg7MPi01khEIzLB",
          "name": "Telegram account"
        }
      },
      "onError": "continueRegularOutput",
      "notes": "–û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞ –æ–± –æ—à–∏–±–∫–µ –ë–î"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö": {
      "main": [
        [
          {
            "node": "–ó–∞–ø–∏—Å–∞—Ç—å –≤ –ë–î",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø–∏—Å–∞—Ç—å –≤ –ë–î": {
      "main": [
        [
          {
            "node": "–í—ã—Ö–æ–¥",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–û—à–∏–±–∫–∞ –ë–î",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏": {
      "main": [
        [
          {
            "node": "–ê–ª–µ—Ä—Ç: –í–∞–ª–∏–¥–∞—Ü–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–ª–µ—Ä—Ç: –í–∞–ª–∏–¥–∞—Ü–∏—è": {
      "main": [
        [
          {
            "node": "–í—ã—Ö–æ–¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û—à–∏–±–∫–∞ –ë–î": {
      "main": [
        [
          {
            "node": "–ê–ª–µ—Ä—Ç: –ë–î",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–ª–µ—Ä—Ç: –ë–î": {
      "main": [
        [
          {
            "node": "–í—ã—Ö–æ–¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "saveExecutionProgress": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "YuKEJrrAk0rOUAWj"
  },
  "versionId": "2a461e13-cc07-4ce7-b863-250623f4381d",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "246861e83e3dee1b76bce7649600b7421f7a891512c38c8790a3a160a7b43c57"
  },
  "id": "YuKEJrrAk0rOUAWj",
  "tags": []
}
